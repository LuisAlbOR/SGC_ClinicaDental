import{a as p,L as P}from"./index-Cyx9wH0p.js";import{e as _}from"./Especialidades-Cb2kmacW.js";import{N as R}from"./NotificationModal-BRD1dcli.js";import{d as S,e as l,m as U,o as d,c as u,a as o,b as i,w as g,u as x,q as $,r as B,F as w,s as M,t as y}from"./index-ZwJaeH-t.js";const H={class:"w-full max-w-md mx-auto mt-10"},I={class:"space-y-4"},K={class:"flex space-x-4"},T=["value"],A=["value"],Q=S({__name:"RegistrarCitaPacientePage",setup(O){const k=$(),C=Number(k.query.id),n=l(""),m=l("success"),h=l([]),q=l([]),c=l(""),v=l([]),b=l(!1),f=l(!1),s=l({fecha:"",hora:"",id_paciente:C,id_medico:0}),L=a=>{const e=a.target.value,r=new Date(e),t=new Date;t.setDate(t.getDate()),r<=t&&(alert("La fecha seleccionada debe ser al menos un día después de la fecha actual."),s.value.fecha=""),s.value.fecha=e},V=a=>a.length===5?`${a}:00`:a,D=async()=>{if(c.value)try{const a=encodeURIComponent(c.value),e=await p.get(`http://localhost:8080/Medico/ListadoMedico/Especialidad/${a}`);v.value=e.data}catch(a){console.error("Error al obtener médicos por especialidad:",a)}else v.value=h.value},E=async()=>{try{const a=await p.get("http://localhost:8080/Medico/ListadoMedico");h.value=a.data}catch(a){console.error("Error al obtener los médicos:",a)}},F=async()=>{try{const a=await p.get("http://localhost:8080/Paciente/ListadoPaciente");q.value=a.data}catch(a){console.error("Error al obtener los pacientes:",a)}},N=async()=>{f.value=!0;const a={...s.value,hora:V(s.value.hora)};console.log(a);try{(await p.post("http://localhost:8080/Cita/RegistrarCita",a)).status===200&&(n.value="Cita registrada exitosamente.",m.value="success",s.value={fecha:"",hora:"",id_paciente:0,id_medico:0})}catch(e){e.response?e.response.data&&e.response.data.message?n.value=e.response.data:n.value=`Error: ${e.response.data} ${e.response.statusText}`:e.request?n.value="No se recibió respuesta del servidor. Por favor, intente nuevamente más tarde.":n.value="Error al configurar la petición. Por favor, intente nuevamente.",m.value="error"}finally{b.value=!0,f.value=!1}};return U(()=>{F(),E()}),(a,e)=>{const r=B("FormKit");return d(),u("div",H,[e[11]||(e[11]=o("h2",{class:"text-2xl font-bold mb-4"},"Registrar Cita Médica",-1)),i(R,{message:n.value,type:m.value,visible:b.value,"onUpdate:visible":e[0]||(e[0]=t=>b.value=!1)},null,8,["message","type","visible"]),i(r,{type:"form",onSubmit:N,class:"space-y-4",actions:!1},{default:g(()=>[i(r,{type:"date",name:"fecha",label:"Fecha",onBlur:L,"input-class":"mt-1 block w-full p-2 border border-gray-300 rounded-md text-black",validation:"required","validation-messages":{required:"La fecha es obligatoria."}}),e[6]||(e[6]=o("br",null,null,-1)),i(r,{type:"time",name:"hora",label:"Hora de la Cita",modelValue:s.value.hora,"onUpdate:modelValue":e[1]||(e[1]=t=>s.value.hora=t),"input-class":"mt-1 block w-full p-2 border border-gray-300 rounded-md text-black",validation:"required","validation-messages":{required:"La hora es obligatoria."}},null,8,["modelValue"]),e[7]||(e[7]=o("br",null,null,-1)),e[8]||(e[8]=o("br",null,null,-1)),o("div",I,[o("div",K,[i(r,{type:"select",name:"especialidad",label:"Especialidad",modelValue:c.value,"onUpdate:modelValue":e[2]||(e[2]=t=>c.value=t),"input-class":"mt-1 block w-full p-2 border border-gray-300 rounded-md text-black",validation:"required","input-error-class":"border-red-500","validation-messages":{required:"La especialidad es obligatoria."}},{default:g(()=>[e[4]||(e[4]=o("option",{disabled:"",value:""},"Seleccione una especialidad",-1)),(d(!0),u(w,null,M(x(_),t=>(d(),u("option",{value:t},y(t),9,T))),256))]),_:1},8,["modelValue"]),o("button",{type:"button",onClick:D,class:"w-20 py-2 px-4 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition duration-300"}," Filtrar ")]),i(r,{type:"select",name:"medico",label:"Médico",modelValue:s.value.id_medico,"onUpdate:modelValue":e[3]||(e[3]=t=>s.value.id_medico=t),"input-class":"mt-1 block w-full p-2 border border-gray-300 rounded-md text-black",validation:"required","validation-messages":{required:"Seleccione un médico."}},{default:g(()=>[e[5]||(e[5]=o("option",{disabled:"",value:"0"},"Seleccione un médico",-1)),(d(!0),u(w,null,M(v.value,t=>(d(),u("option",{key:t.id_medico,value:t.id_medico},y(t.nombreMedico)+" "+y(t.apellidoMedico),9,A))),128))]),_:1},8,["modelValue"])]),e[9]||(e[9]=o("br",null,null,-1)),e[10]||(e[10]=o("button",{type:"submit",class:"w-full py-3 px-6 bg-blue-500 text-white rounded-lg font-semibold hover:bg-blue-600 transition duration-300"}," Registrar Cita Médica ",-1))]),_:1}),i(x(P),{active:f.value,"can-cancel":!0,"is-full-page":!0},null,8,["active"])])}}});export{Q as default};
